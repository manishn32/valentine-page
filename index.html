<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>For You ‚ù§Ô∏è</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <style>
    :root {
      /* Envelope scales with viewport width but capped for larger screens */
      --env-w: min(88vw, 360px);
      --env-h: calc(var(--env-w) * 0.69);       /* similar ratio to your 260x180 */
      --radius: 10px;

      /* Typography using clamp(min, preferred, max) */
      --title-size: clamp(18px, 4.5vw, 24px);
      --btn-font: clamp(15px, 4vw, 18px);

      /* Buttons: comfortable touch targets */
      --btn-pad-y: clamp(10px, 2.4vw, 14px);
      --btn-pad-x: clamp(16px, 4vw, 22px);
      --btn-min-h: 44px; /* recommended minimum for touch */
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
      background-image: url('her.JPG'); /* update if needed */
      background-size: cover;
      background-position: center;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      -webkit-tap-highlight-color: transparent; /* cleaner taps on mobile */
    }

    /* ENVELOPE */
    .envelope {
      width: var(--env-w);
      height: var(--env-h);
      background: #f5c6d6;
      position: relative;
      cursor: pointer;
      border-radius: var(--radius);
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      transition: opacity 0.6s ease;
      will-change: transform, opacity;
    }

    /* Responsive flap created with borders (triangle) */
    .flap {
      width: 0;
      height: 0;
      border-left: calc(var(--env-w) / 2) solid transparent;
      border-right: calc(var(--env-w) / 2) solid transparent;
      border-bottom: calc(var(--env-h) * 0.5) solid #ff9ab5; /* triangle height ~50% of env height */
      position: absolute;
      top: 0;
      left: 0;
      transform-origin: top;
      transition: transform 0.6s;
    }

    /* Letter scales inside */
    .letter {
      position: absolute;
      top: calc(var(--env-h) * 0.11);
      left: calc(var(--env-w) * 0.04);
      width: calc(var(--env-w) - var(--env-w) * 0.08);
      height: calc(var(--env-h) - var(--env-h) * 0.22);
      background: #ffffff;
      border-radius: calc(var(--radius) + 2px);
      text-align: center;
      padding: 10px 12px;
      display: none;
      box-sizing: border-box;
    }

    .letter h3 {
      margin: 8px 8px 14px;
      font-size: var(--title-size);
      line-height: 1.25;
    }

    /* OPEN STATE */
    .open .flap { transform: rotateX(180deg); }
    .open .letter { display: block; }

    /* Buttons */
    button {
      padding: var(--btn-pad-y) var(--btn-pad-x);
      margin: 6px;
      border-radius: 18px;
      border: none;
      cursor: pointer;
      font-weight: 700;
      font-size: var(--btn-font);
      min-height: var(--btn-min-h);
      min-width: 96px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      touch-action: manipulation; /* faster taps + reduce double-tap zoom */
    }

    #yesBtn { background: #4CAF50; color: white; }
    #noBtn  { background: #f44336; color: white; }

    /* --- Valentine message overlay --- */
    #valMsg {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none; /* ignore clicks */
      opacity: 0;
      transition: opacity 0.6s ease;
      padding: 16px; /* avoid edge clipping on very small screens */
      box-sizing: border-box;
    }
    #valMsg > div {
      background: rgba(0,0,0,0.45);
      color: #fff;
      padding: 18px 26px;
      border-radius: 16px;
      font-size: clamp(18px, 4.8vw, 22px);
      font-weight: 700;
      text-align: center;
      backdrop-filter: blur(2px);
    }
    #valMsg.show { opacity: 1; }

    /* Small phones: nudge sizes up slightly */
    @media (max-width: 380px) {
      :root {
        --env-w: min(92vw, 340px);
        --title-size: clamp(18px, 5vw, 24px);
        --btn-font: clamp(16px, 4.6vw, 18px);
      }
    }

    /* Light motion preference */
    @media (prefers-reduced-motion: reduce) {
      .flap, #valMsg { transition: none; }
    }
  </style>
</head>

<body>

  <div class="envelope" id="envelope" aria-label="Open the envelope">
    <div class="flap"></div>

    <div class="letter" id="letter" role="dialog" aria-modal="true" aria-labelledby="title">
      <h3 id="title">Will You Be My Valentine? ‚ù§Ô∏è</h3>
      <button id="yesBtn" aria-label="Yes">Yes</button>
      <button id="noBtn" aria-label="No">No</button>
    </div>
  </div>

  <!-- Valentine message overlay -->
  <div id="valMsg" aria-hidden="true">
    <div>Happy Valentine‚Äôs Day my love ‚ù§Ô∏è<br> Did you like the gifts?</div>
  </div>

  <!-- Firebase (kept as in your original) -->
  <script src="https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

    // --- Firebase Config ---
    const firebaseConfig = {
      apiKey: "AIzaSyAt_RwhWPoBXVL8RNMMVXRckc4GCVFcRWw",
      authDomain: "valentine-c63b3.firebaseapp.com",
      projectId: "valentine-c63b3",
      storageBucket: "valentine-c63b3.firebasestorage.app",
      messagingSenderId: "406251981974",
      appId: "1:406251981974:web:af03ce19b021a2e2a446b7"
    };

    // --- Init ---
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // --- State/Elements ---
    let noCount = 0;
    const envelope = document.getElementById("envelope");
    const letter   = document.getElementById("letter");
    const titleEl  = document.getElementById("title");
    const yesBtn   = document.getElementById("yesBtn");
    const noBtn    = document.getElementById("noBtn");
    const valMsg   = document.getElementById("valMsg");

    // --- UI interactions ---
    function openEnvelope() {
      envelope.classList.add("open");
    }

    async function saveResponse(answer) {
      try {
        // Disable buttons to prevent double submissions
        yesBtn.disabled = true;
        noBtn.disabled  = true;

        await addDoc(collection(db, "responses"), {
          answer,
          time: serverTimestamp()
        });

        if (answer === "YES") {
          showValentineMessageThenFade();
        } else {
          handleNo();
          // Re-enable only after a "No" so they can click again
          yesBtn.disabled = false;
          noBtn.disabled  = false;
        }
      } catch (e) {
        console.error("Error saving response:", e);
        yesBtn.disabled = false;
        noBtn.disabled  = false;
        alert("Oops! Couldn't save your response. Please check your network and try again.");
      }
    }

    function showValentineMessageThenFade() {
      // Show overlay message
      valMsg.classList.add('show');

      // After ~3 seconds, fade out envelope and overlay to leave just the background
      setTimeout(() => {
        // Fade envelope
        envelope.style.opacity = "0";
        // Fade overlay message
        valMsg.classList.remove('show');

        // After transition completes, remove both from layout
        setTimeout(() => {
          envelope.style.display = "none";
          valMsg.style.display = "none";
        }, 650); // matches CSS transition (0.6s) with a tiny buffer
      }, 3000);
    }

    function handleNo() {
      noCount++;

      if (noCount === 1) {
        shake(letter);
        titleEl.innerText = "Please don‚Äôt abandon me ü•∫";
      } else if (noCount === 2) {
        shake(letter);
        titleEl.innerText = "Love, please come with me ‚ù§Ô∏è";
      } else {
        shake(letter);
        titleEl.innerText =
          "Life will have so many ups and downs, this is the only down for us I promise üíû";
      }
    }

    function shake(element) {
      element.animate(
        [
          { transform: 'translateX(0px)'   },
          { transform: 'translateX(-12px)' },
          { transform: 'translateX(12px)'  },
          { transform: 'translateX(-12px)' },
          { transform: 'translateX(12px)'  },
          { transform: 'translateX(0px)'   }
        ],
        { duration: 400 }
      );
    }

    // --- Wire events (no inline attributes) ---
    envelope.addEventListener("click", openEnvelope);

    yesBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      saveResponse("YES");
    });

    noBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      saveResponse("NO");
    });
  </script>
</body>
</html>
