<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>For You ‚ù§Ô∏è</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
      background-image: url('background.jpg'); /* update if needed */
      background-size: cover;
      background-position: center;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* ENVELOPE */
    .envelope {
      width: 260px;
      height: 180px;
      background: #f5c6d6;
      position: relative;
      cursor: pointer;
      border-radius: 8px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      transition: opacity 0.6s ease;
    }

    .flap {
      width: 0;
      height: 0;
      border-left: 130px solid transparent;
      border-right: 130px solid transparent;
      border-bottom: 90px solid #ff9ab5;
      position: absolute;
      top: 0;
      left: 0;
      transform-origin: top;
      transition: transform 0.6s;
    }

    .letter {
      position: absolute;
      top: 20px;
      left: 10px;
      width: 240px;
      height: 140px;
      background: #ffffff;
      border-radius: 10px;
      text-align: center;
      padding-top: 10px;
      display: none;
    }

    /* OPEN STATE */
    .open .flap {
      transform: rotateX(180deg);
    }

    .open .letter {
      display: block;
    }

    button {
      padding: 8px 14px;
      margin: 6px;
      border-radius: 16px;
      border: none;
      cursor: pointer;
      font-weight: 600;
    }

    #yesBtn { background: #4CAF50; color: white; }
    #noBtn  { background: #f44336; color: white; }
  </style>
</head>

<body>

  <div class="envelope" id="envelope">
    <div class="flap"></div>

    <div class="letter" id="letter">
      <h3 id="title">Will You Be My Valentine? ‚ù§Ô∏è</h3>
      <button id="yesBtn">Yes</button>
      <button id="noBtn">No</button>
    </div>
  </div>

<script src="https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js"></script>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

    // --- Firebase Config ---
    const firebaseConfig = {
      apiKey: "AIzaSyAt_RwhWPoBXVL8RNMMVXRckc4GCVFcRWw",
      authDomain: "valentine-c63b3.firebaseapp.com",
      projectId: "valentine-c63b3",
      storageBucket: "valentine-c63b3.firebasestorage.app",
      messagingSenderId: "406251981974",
      appId: "1:406251981974:web:af03ce19b021a2e2a446b7"
    };

    // --- Init ---
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // --- State/Elements ---
    let noCount = 0;
    const envelope = document.getElementById("envelope");
    const letter   = document.getElementById("letter");
    const titleEl  = document.getElementById("title");
    const yesBtn   = document.getElementById("yesBtn");
    const noBtn    = document.getElementById("noBtn");

    // --- UI interactions ---
    function openEnvelope() {
      envelope.classList.add("open");
    }

    async function saveResponse(answer) {
      try {
        // Disable buttons to prevent double submissions
        yesBtn.disabled = true;
        noBtn.disabled  = true;

        await addDoc(collection(db, "responses"), {
          answer,
          time: serverTimestamp()
        });

        if (answer === "YES") {
          fadeEnvelope();
        } else {
          handleNo();
          // Re-enable only after a "No" so they can click again
          yesBtn.disabled = false;
          noBtn.disabled  = false;
        }
      } catch (e) {
        console.error("Error saving response:", e);
        yesBtn.disabled = false;
        noBtn.disabled  = false;
        alert("Oops! Couldn't save your response. Please check your network and try again.");
      }
    }

    function fadeEnvelope() {
      envelope.style.opacity = "0";
      setTimeout(() => {
        envelope.style.display = "none";
      }, 600);
    }

    function handleNo() {
      noCount++;

      if (noCount === 1) {
        shake(letter);
        titleEl.innerText = "Please don‚Äôt abandon me ü•∫";
      } else if (noCount === 2) {
        shake(letter);
        titleEl.innerText = "Love, please come with me ‚ù§Ô∏è";
      } else {
        shake(letter);
        titleEl.innerText =
          "Life will have so many ups and downs, this is the only down for us I promise üíû";
      }
    }

    function shake(element) {
      element.animate(
        [
          { transform: 'translateX(0px)'   },
          { transform: 'translateX(-12px)' },
          { transform: 'translateX(12px)'  },
          { transform: 'translateX(-12px)' },
          { transform: 'translateX(12px)'  },
          { transform: 'translateX(0px)'   }
        ],
        { duration: 400 }
      );
    }

    // --- Wire events (no inline attributes) ---
    envelope.addEventListener("click", openEnvelope);

    yesBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      saveResponse("YES");
    });

    noBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      saveResponse("NO");
    });
  </script>
</body>
</html>
